{% extends 'philosophy.base.html' %}
{% load static tagging %}

{% block body.id %}top{% endblock %}
{% block body %}
    <section class="s-content">

        <div class="row narrow">
            <div class="col-full s-content__header">
                <h1>Öykülerimiz</h1>

                <div style="border:1px black solid; padding:10px">
                    <p style="text-align:left" class="lead">Hızlı menü</p>
                    <ul style="text-align:left">
                        <li><a href="{% url 'notebook:new' %}">Hikaye yaz</a></li>
                        <li><a href="{% url 'notebook:write' %}">Taslaklarım</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row masonry-wrap">
            <div class="masonry infinite-container">

                <div class="grid-sizer"></div>

                {% for narrative in narratives %}

                <article class="infinite-item masonry__brick entry format-standard">


                    <div class="entry__text">
                        <div class="entry__header">

                            <div class="entry__date">
                                <a href="#0">{{ narrative.created_at|date }}</a>
                            </div>
                            <h1 class="entry__title"><a
                                    href="{{ narrative.get_absolute_url }}">{{ narrative.title }}</a>
                            </h1>

                        </div>
                        {% if narrative.lead %}
                        <div class="entry__excerpt">
                            <p>
                                {{ narrative.lead|truncatechars:100 }}
                            </p>
                        </div>
                        {% endif %}
                        {% if narrative.tags.has_tags %}
                        {% tags_for_user 3 as tags %}
                        <div class="entry__meta">
                            <span class="entry__meta-links">
                                {% for tag in tags %}
                                <a href="#0">{{ tag.abstract.name }}</a>
                                {% endfor %}
                            </span>
                        </div>
                        {% endif %}
                    </div>

                </article> <!-- end article -->
                {% endfor %}
            </div> <!-- end masonry -->

            {% if page_obj.has_next %}
            <a style="display:none;" class="infinite-more-link" href="?page={{ page_obj.next_page_number }}">More</a>
            {% endif %}

            <div class="d-flex justify-content-center" style="display:none;">
                <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
        </div> <!-- end masonry-wrap -->

    </section> <!-- s-content -->
    <!-- preloader
    ================================================== -->
    <div id="preloader">
        <div id="loader">
            <div class="line-scale">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </div>
{% endblock body %}

{% block foot %}
<script src="{% static 'philosophy/js/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'philosophy/js/infinite.min.js' %}"></script>
<script>
    var infinite = new Waypoint.Infinite({
        element: $('.infinite-container')[0],
        onBeforePageLoad: function () {
            $iml = $("#infinite-more-link")
            if ($iml) window.href = $iml.href
        },
        onAfterPageLoad: function ($items) {
            $(".masonry").masonry('appended', $items);
        }
    });
</script>
{% endblock %}